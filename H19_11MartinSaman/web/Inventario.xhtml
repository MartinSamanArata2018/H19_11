<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Inventario - Computech</title>
    </h:head>
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="frmRegistrarInventario"><p:growl autoUpdate="true"/>
            <h:panelGrid columns="2">
                <p:outputLabel value="Equipo"/>
                <p:selectOneMenu required="true" filter="true" filterMatchMode="contains"
                                 value="#{inventarioC.inventario.equipo.IDEQ}">
                    <f:selectItems value="#{equipoC.listaEquipo}" var="equipo" 
                                   itemLabel="#{equipo.NOMEQ} - #{equipo.MAREQ} - #{equipo.MODEQ}" itemValue="#{equipo.IDEQ}"/>
                </p:selectOneMenu>
                <p:outputLabel value="Cantidad"/>
                <p:spinner value="#{inventarioC.inventario.CNTINV}" min="1" size="10"
                           required="true" requiredMessage="Ingresar Cantidad"/>
                <p:outputLabel value="Fecha"/>
                <p:calendar value="#{inventarioC.inventario.FECINV}" required="true" requiredMessage="Ingrese Fecha" mask="99/99/9999"
                            mindate="calwidget.today()" widgetVar="calwidget"/>
            </h:panelGrid>
            <p:commandButton value="Guardar" actionListener="#{inventarioC.registrar()}" oncomplete="PF('wvTblInventario').filter()"
                             update="frmRegistrarInventario :frmDatosInventario"/>
        </h:form>
        <h:form id="frmDatosInventario">
            <p:dataTable id="tblInventario" var="inventario" widgetVar="wvTblInventario"
                         selection="#{inventarioC.inventarioSeleccionado}"
                         selectionMode="single" sortBy="#{inventario.FECINV}" sortOrder="descending"
                         rowKey="#{inventario.IDINV}" disabledSelection="#{inventario.TIPINV eq 'S'}"
                         value="#{inventarioC.listaInventario}"
                         filteredValue="#{inventarioC.listaInventarioFiltrado}"
                         rows="10" paginator="true"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="5,10,15,20,30">
                <f:facet name="header">
                    Lista de Equipos Inventariados
                </f:facet>
                <f:facet name="footer">
                    <p:outputPanel>
                        <p:commandButton value="Generar Reporte" actionListener="#{inventarioC.generarReporteGeneral()}" 
                                         update="tblInventario :frmReporte"/>
                    </p:outputPanel>
                </f:facet>
                <p:column headerText="Nombre equipo" filterBy="#{inventario.equipo.NOMEQ}" filterMatchMode="contains">
                    <h:outputText value="#{inventario.equipo.NOMEQ}"/>
                </p:column>
                <p:column headerText="Marca equipo" filterBy="#{inventario.equipo.MAREQ}" filterMatchMode="contains">
                    <h:outputText value="#{inventario.equipo.MAREQ}"/>
                </p:column>
                <p:column headerText="Modelo equipo" filterBy="#{inventario.equipo.MODEQ}" filterMatchMode="contains">
                    <h:outputText value="#{inventario.equipo.MODEQ}"/>
                </p:column>
                <p:column headerText="Cantidad">
                    <h:outputText value="#{inventario.CNTINV}"/>
                </p:column>
                <p:column headerText="Tipo">
                    <h:outputText value="#{inventario.TIPINV eq 'E'? 'Entrada':'Salida'}"/>
                </p:column>
                <p:column headerText="Fecha" filterBy="#{inventario.FECINV}" filterMatchMode="equals">
                    <f:facet name="filter">
                        <p:calendar>
                            <p:ajax event="dateSelect" oncomplete="PF('wvTblInventario').filter()" update="tblInventario"/>
                            <p:ajax event="change" oncomplete="PF('wvTblInventario').filter()" update="tblInventario"/>
                        </p:calendar>
                    </f:facet>
                    <h:outputText value="#{inventario.FECINV}">
                        <f:convertDateTime pattern="dd/MMM/yyyy" />
                    </h:outputText>
                </p:column>

            </p:dataTable>
            <p:contextMenu for="tblInventario">
                <p:menuitem value="Modificar" oncomplete="PF('dlgModInventario').show();" update=":frmModInventario"/>
                <p:menuitem value="Eliminar" actionListener="#{inventarioC.eliminar()}" oncomplete="PF('wvTblInventario').filter()" update="frmDatosInventario"/>
            </p:contextMenu>
        </h:form>
        <h:form id="frmReporte" style="height: 100%;">
            <p:media value="#{inventarioC.reporte}" cache="false" player="pdf" height="100%" width="100%"/>
        </h:form>
        <p:dialog widgetVar="dlgModInventario">
            <h:form id="frmModInventario"><p:growl autoUpdate="true"/>
                <h:panelGrid columns="2">
                    <p:outputLabel value="Cantidad"/>
                    <p:spinner value="#{inventarioC.inventarioSeleccionado.CNTINV}" required="true" requiredMessage="Ingrese cantidad"/>
                    <p:outputLabel value="Fecha"/>
                    <p:calendar value="#{inventarioC.inventarioSeleccionado.FECINV}" required="true" requiredMessage="Ingrese fecha" 
                                mindate="#{inventarioC.inventarioSeleccionado.FECINV}" mask="99/99/9999"/>
                </h:panelGrid>
                <p:commandButton value="Modificar" actionListener="#{inventarioC.editar()}"
                                 update=":frmDatosInventario" oncomplete="if(!args.validationFailed)PF('dlgModInventario').hide();PF('wvTblInventario').filter();"/>
            </h:form>
        </p:dialog>

    </h:body>
</html>

